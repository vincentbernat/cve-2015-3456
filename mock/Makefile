CFLAGS = -O0 -g -Wall -std=c99 -fpic
LDFLAGS = -Wl,-z,relro -Wl,-z,now
TARGETS = mock mock-pie
OBJECTS = mock.o fdc.o

all: $(TARGETS) $(TARGETS:%=%-stripped)
clean:
	rm -f $(OBJECTS) $(TARGETS) $(TARGETS:%=%-stripped)

# The regular version and the PIE version
mock: $(OBJECTS)
	$(CC) $(LDFLAGS) -o $@ $^
mock-pie: $(OBJECTS)
	$(CC) $(LDFLAGS) -pie -fpie -o $@ $^

# How to build a stripped version
%-stripped: %
	cp $< $@
	strip -s $@

.PHONY: all clean
